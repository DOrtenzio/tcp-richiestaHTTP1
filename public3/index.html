<!doctype html>
<html lang="it">
    <head>
        <title>Api Utente</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <link rel="icon" type="image/x-icon" href="favicon.ico" />
    </head>

    <body>
        <main>
            <div class="d-block bg-primary text-white p-3">
                <h1 class="text-center">Richiesta HTTP con Fetch API JavaScript</h1>
            </div>
            <div class="container" >
                <div id="div-header-botton" class="d-flex flex-column my-3 justify-content-center align-items-center">
                    <h1 class="text-center my-3">Elenco Utenti</h1>
                    <div id="barra-pulsanti" class="p-3">
                        <button class="btn btn-success mx-3" onclick="vista_aggiunta()">Aggiungi Utente</button>
                    </div>
                </div>
                <form id="vista_aggiunta" class="flex-column my-3 justify-content-center align-items-center" name="input" style="display: none;">
                    <label for="name" class="form-label me-2">Nome Utente:</label>
                    <input class="" type="text" placeholder="Inserisci il nome dell'utente" name="name">
                    <br>
                    <br>
                    <label for="name" class="form-label me-2">Età Utente:</label>
                    <input class="" type="text" placeholder="Inserisci l'età dell'utente" name="eta">
                    <button class="btn btn-primary" type="button" onclick="aggiungi()">Inserisci</button>
                </form>
                <div class="row" id="contenitore" >
                   
                </div>
               

            </div>
            <template id="template">
                <div class="card shadow m-5 pt-2" style="width: 18rem;">
                    <img src="https://picsum.photos/200/100?random=" class="card-img-top" alt="Immagine casuale" />
                    <div class="card-body">
                        <h5 class="card-title"></h5>
                        <h6 class="card-subtitle mb-2 text-body-secondary"></h6>
                        <p class="card-text"></p>
                        <a href="#" class="card-link"></a>
                    </div>
                </div>
            </template>

        </main>


        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>

        <script>
            function vista_aggiunta(){
                const form = document.getElementById("vista_aggiunta");
                form.style.display = form.style.display === "none" ? "flex" : "none";
            }
            function aggiungi(){
                let nome=input.name.value;
                let eta=input.eta.value;
                if( !empty(trim(nome)) && !empty(trim(eta))){
                    fetch('https://supreme-sniffle-g5x5g7g6p6w2p7wg-3000.app.github.dev/api/users', {
                        method: 'POST',
                        headers: {
                            'accept': '*/*',
                            'Authorization': 'Bearer 5IDtoken',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            'name': nome,
                            'age': eta
                        })
                    });
                }
            }
        </script>

        <script>
            fetch('https://supreme-sniffle-g5x5g7g6p6w2p7wg-3000.app.github.dev/api/users', {
                headers: {
                    'accept': '*/*'
                }
            })
            .then(response => {
                if(!response.ok){
                    throw new Error ("Errore nella risposta");
                }
                return response.json();
            })
            .then(data => {
                data.forEach(user=>{
                    console.log(user);
                    const cloneCard=document.getElementById("template").content.cloneNode(true);
                    cloneCard.querySelector(".card-title").textContent=user.name;
                    if(user.role && user.role!==""){
                        cloneCard.querySelector(".card-subtitle").textContent=`Ruolo: ${user.role}`;
                    }else{
                        cloneCard.querySelector(".card-subtitle").textContent=`Ruolo: Non Presente`;
                    }
                    cloneCard.querySelector(".card-text").textContent=`Età: ${user.age}`;
                    if(user.data){
                        let testo="";
                        for(cont [chiave,valore] of Object.entries(user.data)){
                            testo+=`<p class=".card-text">${chiave}:</p> ${valore}<br>`;
                        }
                    }
                        
                    cloneCard.querySelector(".card-link").style.display="none";
                    document.getElementById("contenitore").appendChild(cloneCard);
                })
            })
            .catch(error => console.error('Errore:', error));
        </script>
    </body>